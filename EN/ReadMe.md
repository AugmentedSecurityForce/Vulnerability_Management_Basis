- [PURPOSE](#purpose)
- [DEFINITION](#definition)
  - [SOME KEY TERMS TO KNOW ABOUT VULNERABILITIES](#some-key-terms-to-know-about-vulnerabilities)
    - [EOL - END OF LIFE](#eol---end-of-life)
    - [CVE](#cve)
    - [SCORE CVSS](#score-cvss)
      - [CVSS IN ONE LINE](#cvss-in-one-line)
    - [CWE](#cwe)
    - [NVD](#nvd)
    - [0-DAY](#0-day)
    - [KEV](#kev)
    - [EPSS](#epss)
- [EXERCICE PRATIQUE - LECTURE D'UNE CVE FORTI DE JUIN CVE CVE-2023-27997](#exercice-pratique---lecture-dune-cve-forti-de-juin-cve-cve-2023-27997)
- [VULNERABILITY MANAGEMENT LIFECYCLE](#vulnerability-management-lifecycle)
  - [DISCOVER](#discover)
  - [PRIORITIZE](#prioritize)
  - [ASSESS](#assess)
  - [REPORT](#report)
  - [REMEDIATE](#remediate)
    - [RISK MANAGEMENT](#risk-management)
      - [RISK ACCEPTANCE](#risk-acceptance)
    - [RISK REFUSAL](#risk-refusal)
    - [RISK DEFERRAL](#risk-deferral)
    - [RISK CANCELLATION](#risk-cancellation)
  - [VERIFY](#verify)
    - [TOOL - OPENVAS](#tool---openvas)
    - [TOOL - NMAP](#tool---nmap)
    - [TOOL - WAZUH (link to LD post)](#tool---wazuh-link-to-ld-post)

# PURPOSE
In this article, we will explore how to manage vulnerabilities within your IT environment. Whether you are a technician, aspiring manager, administrator, etc., understanding how to address vulnerabilities within the organization can shed light on certain decision-making processes.
# DEFINITION
In the field of computer security, a vulnerability or flaw is a weakness in a computer system that allows an attacker to compromise the integrity of the system, that is, its normal operation, confidentiality, or the integrity of the data it contains.

Several points to remember:

- Weakness can have human origins (e.g., social engineering, reused passwords), technical origins (e.g., outdated software, incorrect configuration), or even architectural origins (e.g., poor segmentation, lack of redundancy in critical services).
- It must compromise at least one of the following factors:
  - Confidentiality: only authorized individuals have access to the data.
  - Integrity: only authorized individuals or processes can modify the data.
  - Availability: the information is accessible whenever needed and without delay.
- Weakness can be exploited by an attacker, whether internal or external, intentionally or unintentionally.

"This implies that if at least one of these factors is reduced, the threat represented by the vulnerability will be diminished."
## SOME KEY TERMS TO KNOW ABOUT VULNERABILITIES
There are some terms to know and understand when talking about vulnerabilities.
### EOL - END OF LIFE
The first vulnerability that comes to mind is the "End of Support" (EOL) issue. You will inevitably encounter this vulnerability at least once in your professional life.

This can range from an Android phone that no longer receives security patches to an outdated operating system like [Windows 3.1](https://www.google.com/search?client=opera-gx&q=windows+3.1+airport&sourceid=opera&ie=UTF-8&oe=UTF-8), or even industrial software that still functions but replacing it would be prohibitively expensive.

A good starting point to monitor the obsolescence of your IT infrastructure is to use [this website](https://endoflife.date) in conjunction with your Configuration Management Database (CMDB).
### CVE
CVE (Common Vulnerabilities and Exposures) is a public list of computer security flaws. It provides a unique identifier for each vulnerability in the format CVE-YEAR-UniqueID.

This list is maintained by [MITRE](https://www.mitre.org) with the support of the United States Department of Homeland Security.

Its objective is to identify, define, and catalog publicly disclosed cybersecurity vulnerabilities.

When you receive an alert about the presence of CVEs in your infrastructure, it's important to understand that you only have the bare minimum of information. There are no technical details provided, only the targeted software, the affected version, and the existing corrective version if available.

Example:

![EX_CVE](./Images/EX_CVE.png)
### SCORE CVSS
The Common Vulnerability Scoring System (CVSS) provides a severity rating (not a risk rating) on a scale from 0 to 10, with 10 being the maximum score.

| Score   | Severity    |
|:-------:|:-----------:|
| 0       | None        |
| 0.1 to 3.9 | Low       |
| 4 to 6.9 | Medium      |
| 7 to 8.9 | High        |
| 9 to 10 | Critical    |

The CVSS standard is managed by the organization [FIRST.Org](https://www.first.org).

The score takes into account several vectors, such as:

- Attack Vector: Describes how an attacker can reach the vulnerable component. For example, whether it requires physical access, local access, or network access.
- Attack Complexity: Reflects the level of difficulty an attacker faces to exploit the vulnerability successfully. It considers factors like whether specialized conditions or certain configuration settings are necessary.
- Privileges Required: Indicates the level of privileges an attacker needs to exploit the vulnerability. It considers whether the attacker requires no privileges, low privileges, or high privileges on the target system.
- User Interaction: Determines if the vulnerability can be exploited without any user interaction, or if user involvement is needed to trigger the exploit.

These vectors collectively contribute to the overall CVSS score, providing an assessment of the severity of the vulnerability and its potential impact on the affected system.

![CVSS_calculator](./Images/CVSS_CALC.png)
#### CVSS IN ONE LINE
In an "optimization" perspective, it is rare to find a complete table in alert bulletins; most often, you will encounter a list of characters summarizing the table.

For example, CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N represents the following table:

| Metric                | Value  |
|-----------------------|--------|
| CVSS Version          | 3.1    |
| Attack Vector (AV)    | Network (N) |
| Attack Complexity (AC)| Low (L) |
| Privileges Required (PR) | None (N) |
| User Interaction (UI) | Required (R) |
| Scope (S)             | Changed (C) |
| Confidentiality (C)   | Low (L) |
| Integrity (I)         | Low (L) |
| Availability (A)      | None (N) |
![CVSS_ONELINE](./Images/CVSS_ONELINE.png)

To learn more about CVSS : [Common Vulnerability Scoring System Version 3.0 Calculator](https://www.first.org/cvss/calculator/3.0)
### CWE
CWE (Common Weakness Enumeration) is a public list of vulnerabilities that can be encountered in software.

This list is maintained by [MITRE](https://www.mitre.org) with the support of the United States Department of Homeland Security.

While CVE focuses on identifying and referencing specific vulnerabilities in software and systems, CWE concentrates on common weaknesses in development and coding practices that can lead to vulnerabilities.

Exemple : 

![TOP25_CWE](./Images/TOP25_CWE.png)
### NVD
The NVD (National Vulnerability Database) is the repository for U.S. government vulnerability management data based on standards and represented using the Security Content Automation Protocol (SCAP). These data facilitate the automation of vulnerability management, security measurement, and compliance.

The NVD comprises reference databases of security checklists, software vulnerabilities related to security, misconfigurations, product names, and impact metrics.

Using resources like Power Automate, this type of tool can significantly save time in the day-to-day processing of alerts.

[Link to the documentation](https://powerautomate.microsoft.com/fr-FR/connectors/details/shared_nistnationalvulnerip/nist-nvd-independent-publisher/)
### 0-DAY
A "0-day" vulnerability refers to a software vulnerability that is unknown to the software vendor or the general community. This means that the software developers are not yet aware of this vulnerability, and no fix or patch has been released. As a result, attackers can exploit this vulnerability without appropriate defense measures being available. The term "0-day" refers to the fact that the attack occurs on the same day the vulnerability is discovered, without any time for the software to be fixed or patched.
### KEV
KEV (Known Exploited Vulnerability) refers to a known vulnerability that is currently being actively exploited by attackers. In this case, the vulnerability has already been discovered and reported, and there may be patches or updates available to address the issue. However, despite this, some systems have not yet applied these fixes, and attackers are actively exploiting the vulnerability to compromise these unprotected systems.

To stay informed about KEVs, I recommend subscribing to [this website](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).

Exemple : 

![KEV](Images/KEV.png)
### EPSS
EPSS (Exploit Prediction Scoring System) is a data-driven system used to estimate the probability of a software vulnerability being exploited in the wild. The EPSS model generates a probability score ranging from 0 to 1 (0 to 100%). A higher score indicates a greater likelihood of the vulnerability being exploited.

This system originates from FIRST, the same organization that manages CVSS.

In the appendix, you will find an Excel file to calculate your EPSS score.

![EPSS_Calc](Images/EPSS_CALC.png)

As discussed earlier, the CVSS score tends to have higher values over time because it naturally focuses on identifying the most critical vulnerabilities, those that can be exploited without user interaction and grant maximum privileges.

The challenge arises when everything seems important and urgent to patch due to the high CVSS scores. This is where EPSS comes into play by providing an indication of the probability of exploitation. However, it is important to note that the EPSS scoring system may penalize certain software vendors. No solution is perfect, and understanding the weaknesses of each system is crucial.

For further reading and exploration:
- [Research Paper: "EPSS: Exploit Prediction Scoring System"](https://arxiv.org/abs/1908.04856)
- [Research Paper: "EPSS: A New Framework for Prioritizing Vulnerability Remediation"](https://arxiv.org/pdf/2302.14172.pdf)
- [Official EPSS Website](https://www.first.org/epss/)
- [EPSS for each CVE, generated daily](https://www.first.org/epss/data_stats)
# EXERCICE PRATIQUE - LECTURE D'UNE CVE FORTI DE JUIN CVE CVE-2023-27997
For example, here are the details related to the CVE Fortinet from June:

CVE Identifier: CVE-2023-27997
CVSS Score: 9.8
CWE Used: CWE-122
EPSS Exploitation Percentage: 95.153%
Initial Attack Vector: Network
Version from which the 6.4 branch is no longer vulnerable: 6.4.12
Is it a KEV? No

# VULNERABILITY MANAGEMENT LIFECYCLE
Here we will see one of the many ways to represent the lifecycle of a vulnerability. As is often the case, there are several models available for this purpose.

![vmlc](Images/vmlc.gif)
## DISCOVER
It is essential to inventory each asset (hardware, software, versions, contracts, certificates, etc.) in your infrastructure.

Explore your infrastructure thoroughly, considering not only what you know about your assets but also what you may not be aware of, such as VPNs set up by administrators to access Project X infrastructure without going through the corporate VPN, or publicly exposed RDP bounces "just in case."

To achieve this, consider conducting periodic scans of your infrastructure.

If you believe you are immune to Shadow IT, ask yourself if you are [better than NASA](https://gizmodo.com/hacker-used-raspberry-pi-to-steal-sensitive-nasa-docs-1835802380)?
## PRIORITIZE
Now that you have listed all your equipment, you must group them by their criticality for your company and by their role.

For instance, your network equipment can be grouped under the "Network Infrastructure" category and each device assigned a criticality level (for example, the backbone will be rated as critical, while the hub used for MDT deployments may have a lower impact on your operations if lost).

You will not protect the PC used for displaying the canteen menu with the same intensity (in terms of time, financial resources, and human efforts) as you would protect your Citrix farm used for production purposes.
## ASSESS
Using vulnerability detection tools is essential in managing the security of your systems. While you can perform manual checks when you are at home or dealing with a small setup, in an enterprise, maintaining reliable controls without software assistance becomes impractical.

Imagine having to manually verify each month that your Windows servers have received and installed every necessary security update (KB). Then, add the task of updating third-party software (.NET, Office, Java, internet browsers, etc.). Finally, include audits on configurations such as checking for active TLS 1.0, proper HSTS configuration, etc. The sheer magnitude of these tasks makes it humanly impossible to manage efficiently.

In an enterprise environment, utilizing specialized vulnerability scanning tools is crucial. These tools automate the process of detecting and assessing vulnerabilities across your network, applications, and systems. They not only help identify missing patches but also highlight potential misconfigurations and weak points in your infrastructure. By using such tools, you can proactively manage security risks and ensure a more robust defense against potential threats.
## REPORT
Once vulnerability detection is completed, the next step is to compile a comprehensive detection report. This report should serve as a guide for the technical teams to implement the necessary corrections (if available), mitigation methods (if available), and even the method of detecting compromises (if applicable). Additionally, the report should provide crucial insights for the management teams to prioritize actions and understand the significance of the issues at hand.
## REMEDIATE
The section regarding the prioritization of corrective actions is based on the information gathered from various sources, including asset groups, asset criticality, and vulnerability descriptions. The conventional approach for prioritizing vulnerabilities relies solely on the CVSS score, which can sometimes yield seemingly unusual outcomes, such as prioritizing the patching of Keepass with a CVSS score of 9.8/10 over a Windows system with four pending updates and scores of 9.1/10.

A method that I prefer is to prioritize vulnerabilities by combining the CVSS score with the probability of exploitation obtained from EPSS. By doing so, only critical vulnerabilities with a high probability of exploitation will undergo an urgent upgrade procedure.

This approach ensures that the prioritization of actions aligns more closely with the real-world risks faced by the organization. It addresses the limitations of the CVSS score, which focuses solely on the inherent severity of a vulnerability but doesn't consider its likelihood of exploitation in the wild. By incorporating EPSS data, which estimates the probability of exploitation, organizations can better allocate their resources and focus on addressing the most pressing security risks first.

By adopting this combined approach, security teams can efficiently manage their efforts, effectively address critical vulnerabilities, and mitigate the potential impact of cyber threats on the organization's systems and data. It provides a more comprehensive view of the actual risk posed by vulnerabilities, helping organizations make well-informed decisions to enhance their overall security posture.

Example (you can adapt it to your needs):

|            | CVSS 0.1 to 3.9 | CVSS 4 to 6.9 | CVSS 7 to 8.9 | CVSS 9+    |
|------------|:---------------:|:---------------:|:---------------:|:---------------:|
| EPSS 0.111% to 30% | Low        | Medium -     | Medium       | Medium       |
| EPSS 40% to 69.999% | Medium -    | Medium       | Medium +     | High         |
| EPSS 70% to 89.999% | Medium      | Medium +     | High         | High         |
| EPSS 90%+         | Medium      | High         | High         | Critical     |

In this example, we have a matrix that combines the CVSS score range and the EPSS probability of exploitation range to prioritize vulnerabilities. Each cell in the matrix represents the priority level based on these combined factors.

- CVSS Score Range:
  - 0.1 to 3.9: Low severity
  - 4 to 6.9: Medium severity
  - 7 to 8.9: High severity
  - 9+: Critical severity

- EPSS Probability of Exploitation Range:
  - 0.111% to 30%: Low probability
  - 40% to 69.999%: Medium probability
  - 70% to 89.999%: High probability
  - 90%+: Critical probability

Based on the intersection of the CVSS score and EPSS probability, each vulnerability is assigned a priority level ranging from Low to Critical. This approach helps in determining the urgency of addressing vulnerabilities by considering both their inherent severity (CVSS score) and the likelihood of exploitation (EPSS probability). Vulnerabilities with a higher combined risk receive higher priority for remediation to mitigate potential threats effectively.

In this specific case, the CVE "CVE-2023-20867" has a CVSS score of 3.9/10, which might have made it seem less critical. However, the EPSS probability of exploitation is 79.661%, indicating a relatively high likelihood of the vulnerability being exploited in case of compromise. This information raises concerns about the potential risk associated with this vulnerability.

The description of the CVE states that "A fully compromised ESXi host can force VMware Tools to not authenticate operations between hosts, impacting the confidentiality and integrity of the guest virtual machine." Given the potential impact on confidentiality and integrity, it is reasonable to consider raising the priority for applying the patch or mitigation.

In this scenario, the combination of CVSS score and EPSS probability reveals that while the inherent severity of the vulnerability might not seem very high, the probability of it being exploited is significant. Consequently, it is essential to give serious consideration to addressing this vulnerability promptly to minimize the risk of potential attacks and protect the confidentiality and integrity of the affected virtual machines.
### RISK MANAGEMENT
Once the risk is identified, several solutions are available to address the vulnerability. Each of these solutions is feasible for either all or part of your IT infrastructure.
#### RISK ACCEPTANCE
Risk acceptance involves acknowledging the existence of a risk but choosing not to implement corrective measures to address it. This decision is made when the cost or potential impact of security measures to mitigate the risk is disproportionate to the severity of the risk itself.

In the presented scenario, the PC hosting the application for self-reservation at your company has an unpatchable vulnerability due to the end of support for the operating system. Replacing the equipment with a new one would require re-development of the non-priority tool. However, the PC is isolated within a dedicated VLAN with strict flow management policies, and it has no internet access.

Given these circumstances, your organization's management decides to accept the risk and continue operating the obsolete PC.
### RISK REFUSAL
Risk refusal involves taking measures to eliminate or significantly reduce the risk by avoiding the activity or situation that gives rise to the risk. For example, it may involve abandoning or discontinuing certain activities that pose an unacceptable level of risk.

In the given scenario, your company has been using a document-sharing tool for sensitive data for a long time. During an audit, you discover a vulnerability that could compromise the confidentiality of the data. After obtaining approval from your supervisor, you provide a report to your management explaining the vulnerability, its impact, and the methodology used to demonstrate the vulnerability.

To avoid this vulnerability, your company decides to stop using the current document-sharing tool and migrate to another solution.
### RISK DEFERRAL
Risk deferral or postponement occurs when additional information is needed to properly assess the vulnerability, or when current resources do not allow for immediate action to correct the issue.

In the given scenario, your company uses a software tool like Keepass. During your monitoring activities, you discover that the tool is affected by a CVE, but the patch is not yet available.

After conducting further research, you learn that the patch will only be released in the next version, scheduled for release in one month. Additionally, there is no technical information available about the vulnerability during this period.

You inform your management about the situation, and based on the available information, they decide to defer the final decision-making process. In the meantime, the company can continue to use the software tool.
### RISK CANCELLATION
"Risk cancellation" means that a preventive measure has been implemented to completely eliminate the identified risk. This involves taking specific actions to eliminate or reduce the probability of the risk occurring or its consequences.

Concrete Case: Every month, you write a report on the vulnerabilities present in your Windows computer park.

You inform your manager that these types of alerts recur regularly, especially during the Patch Tuesday, and that the manual corrective actions take a significant amount of time to plan and control.

As a result, your management decides to implement a server with the WSUS role to manage updates and deployment reports. They also decide to configure Group Policy Objects (GPOs) to automate the deployment and restart of computers and set up supervision to monitor the patching status of the systems.
## VERIFY
Indeed, once a remediation is chosen, it is controlled and documented in a system that allows for review and tracking of each vulnerability.

As an administrator, you will need to provide evidence of correction (modified code, deployed patch and its installation proof, etc.). As a manager or responsible individual, you will sign off on the report submitted by your colleagues, indicating the acceptance or deferral of the risk. In the case of risk acceptance or deferral, you will define the initial date and the review date of the vulnerability.

Having such documentation and tracking system is essential for maintaining accountability and ensuring that the necessary actions are taken to address vulnerabilities effectively. It also helps in maintaining a comprehensive record of remediation efforts and the status of vulnerabilities, facilitating continuous improvement and security enhancements in the organization's IT infrastructure.